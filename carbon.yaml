# demo file

---
name: Create Project from ArdanLabs Service Demo

env:
  base_path: "/Users/njs/go/src/github.com/nslaughter/myservice"

steps:

  - name: Clone ArdanLabs base service repo
    git:
      vars:
        source: https://github.com/ardanlabs/service
        dest: $base_path
      commands:
        - clone

  - name: Replace module and deps info
    shell:
      vars:
        dir: $base_path
      commands:
        - rm go.mod go.sum
        - rm -rf vendor
        - go mod init
        - go mod tidy
        - go mod vendor

  - name: Replace text in all files from service repo
    text_replace:
      vars:
        dir: $base_path
        exclude: ["vendor", ".git"]
      substitutions:
        - {"old": "app/", "new": "cmd/"}
        - {"old": "zarf/", "new": "deploy/"}
        - {"old": "business/", "new": "domain/"}
        - {"old": "foundation/", "new": "infra/"}

  - name: Move package directories
    path_rename:
      vars:
        dir: $base_path
        exclude: ["vendor", ".git"]
      substitutions:
      - {"old": "ardanlabs/service", "new": "nslaughter/myservice"}
      - {"old": "github.com/emadolsky/automaxprocs", "new": "go.uber.org/automaxprocs"}
